<!DOCTYPE html>
<html lang="en-us">
    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Huy Le Vu - International trade and development in Vietnam">
        <meta name="keywords" content="Huy Le Vu, Economics, Vietnam">
        <meta name="author" content="Huy Le Vu">
        
        <title>Huy Le Vu - Economics Researcher</title>
        
        <!-- Favicon -->
        <link rel="icon" type="image/jpeg" href="/avt.jpg">
        
        <!-- Styles -->
        <link rel="stylesheet" type="text/css" href="/style.css">
        
        <!-- Research page specific styles -->
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            .main-wrapper {
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem 1.5rem;
            }
            .main-col {
                max-width: 100%;
                width: 100%;
            }
        </style>
    </head>

<body>
    <div class="main-wrapper">
        <div class="main-col">
            <p><a href="/">&larr; Back to homepage</a></p>

            <!-- Selected Papers -->
            <div class="papers-block">
                <h2 class="papers-title">Selected Paper</h2>
                <div id="selected-papers" class="papers-list"></div>
            </div>

            <!-- Working Papers -->
            <div class="papers-block">
                <h2 class="papers-title">Working Papers</h2>
                <div id="working-papers" class="papers-list"></div>
            </div>

            <!-- Work In Progress -->
            <div class="papers-block">
                <h2 class="papers-title">Selected Work In Progress</h2>
                <div id="work-in-progress" class="papers-list"></div>
            </div>
            
            <!-- Book -->
            <div class="papers-block">
                <h2 class="papers-title">Book</h2>
                <div id="books" class="papers-list"></div>
            </div>

            <!-- Other Projects -->
            <div class="papers-block">
                <h2 class="papers-title">Other Projects</h2>
                <div id="projects" class="papers-list"></div>
            </div>
        </div>
    </div>

    <script>
    // Helper: render coauthors
    function renderCoauthors(coauthors) {
        if (!coauthors || coauthors.length === 0) return '';
        const names = coauthors.map(a => 
            a.url ? `<a href="${a.url}">${a.name}</a>` : a.name
        );
        return 'with ' + names.join(', ');
    }

    // Helper: render a paper item
    function renderPaper(paper) {
        const titleLink = paper.url 
            ? `<a href="${paper.url}">${paper.title}</a>` 
            : `<a>${paper.title}</a>`;
        
        let details = '';
        if (paper.coauthors && paper.coauthors.length > 0) {
            details += renderCoauthors(paper.coauthors);
        }
        if (paper.note) {
            details += details ? ',<br>' + paper.note : paper.note;
        }
        if (paper.journal) {
            if (details) details += '<br>';
            details += `<span class="journal">${paper.journal}</span>`;
            if (paper.volume) details += `, ${paper.volume}`;
            if (paper.date) details += `, ${paper.date}`;
            details += '.';
        }

        let abstractHtml = '';
        if (paper.abstract) {
            abstractHtml = `
                <div class="abstract-row">
                    <button type="button" class="abstract-toggle" aria-expanded="false">+ Abstract</button>
                    <div class="abstract-content">
                        <p>${paper.abstract}</p>
                    </div>
                </div>`;
        }

        return `
            <div class="paper-item">
                ${titleLink}
                <div class="paper-details">${details}</div>
                ${abstractHtml}
            </div>`;
    }

    // Helper: render a book item
    function renderBook(book) {
        const titleLink = book.url 
            ? `<a href="${book.url}">${book.title}</a>` 
            : `<a>${book.title}</a>`;
        
        return `
            <div class="paper-item">
                ${titleLink}
                <div class="paper-details">${book.description || ''}</div>
            </div>`;
    }

    // Helper: render a project organization
    function renderProject(project) {
        const items = project.items.map(item => 
            `<p class="project-item"><span class="project-year">${item.year}:</span> ${item.title}</p>`
        ).join('');

        return `
            <div class="paper-item">
                <a class="project-org-link" href="${project.org_url}">${project.organization}</a>
                <div class="paper-details">${items}</div>
            </div>`;
    }

    // Initialize abstract toggles
    function initAbstractToggles() {
        document.querySelectorAll('.abstract-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const row = this.closest('.abstract-row');
                if (!row) return;
                const content = row.querySelector('.abstract-content');
                if (!content) return;
                
                const expanded = this.getAttribute('aria-expanded') === 'true';
                
                if (expanded) {
                    this.textContent = '+ Abstract';
                    this.setAttribute('aria-expanded', 'false');
                    content.style.maxHeight = null;
                    content.classList.remove('open');
                } else {
                    this.textContent = 'âˆ’ Abstract';
                    this.setAttribute('aria-expanded', 'true');
                    content.classList.add('open');
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
            });
        });
    }

    // Load and render data
    fetch('research.json')
        .then(response => response.json())
        .then(data => {
            // Selected Papers
            if (data.selected_papers) {
                document.getElementById('selected-papers').innerHTML = 
                    data.selected_papers.map(renderPaper).join('');
            }

            // Working Papers
            if (data.working_papers) {
                document.getElementById('working-papers').innerHTML = 
                    data.working_papers.map(renderPaper).join('');
            }

            // Work In Progress
            if (data.work_in_progress) {
                document.getElementById('work-in-progress').innerHTML = 
                    data.work_in_progress.map(renderPaper).join('');
            }

            // Books
            if (data.books) {
                document.getElementById('books').innerHTML = 
                    data.books.map(renderBook).join('');
            }

            // Projects
            if (data.projects) {
                document.getElementById('projects').innerHTML = 
                    data.projects.map(renderProject).join('');
            }

            // Initialize toggles after content is loaded
            initAbstractToggles();
        })
        .catch(error => {
            console.error('Error loading research data:', error);
        });
    </script>

</body>
</html>
